package com.wellsfargo.wips.spring.config;

import javax.sql.DataSource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.DependsOn;
import org.springframework.core.env.Environment;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.datasource.DataSourceTransactionManager;
import org.springframework.transaction.PlatformTransactionManager;
import org.springframework.transaction.annotation.EnableTransactionManagement;

@Configuration
@EnableTransactionManagement
public class WIPSOrmConfig {

    @Autowired
    private Environment environment;

    @Autowired
    @Qualifier("cdbDataSource")
    private DataSource cdbDataSource;

    @Autowired
    @Qualifier("wipsDataSource")
    private DataSource wipsDataSource;

    @Bean
    @Qualifier("jdbcTemplate")
    @DependsOn("wipsDataSource")
    public JdbcTemplate jdbcTemplate() {
        JdbcTemplate jdbcTemplate = new JdbcTemplate(wipsDataSource);
        jdbcTemplate.setResultsMapCaseInsensitive(true);
        return jdbcTemplate;
    }

    @Bean
    @Qualifier("cdbJdbcTemplate")
    @DependsOn("cdbDataSource")
    public JdbcTemplate cdbJdbcTemplate() {
        JdbcTemplate jdbcTemplate = new JdbcTemplate(cdbDataSource);
        jdbcTemplate.setResultsMapCaseInsensitive(true);
        return jdbcTemplate;
    }

    @Bean(name = "transactionManager")
    public PlatformTransactionManager txManager() {
        return new DataSourceTransactionManager(wipsDataSource);
    }
}
